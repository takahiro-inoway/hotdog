<head>
  <title>
    Hot Dog | 業務ツール
  </title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <link rel="stylesheet" href="{{ asset('/css/bulma-docs.min.css') }}">

  <script src="https://kit.fontawesome.com/8061408f79.js" crossorigin="anonymous"></script>

  <script src="https://unpkg.com/@popperjs/core@2"></script>
  <script src="https://unpkg.com/tippy.js@6"></script>

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* Firefox, Opera, Safari */
    @font-face {
      font-family: mplus-1p-light;
      src: url("font/MPLUS1-VariableFont_wght.ttf") format("truetype")
    }

    /***********/
    /**[ bulma ]**/
    /***********/
    .tag {
      user-select: none;
    }

    .field {
      margin-bottom: 0 !important;
    }

    .field-label {
      margin-right: 0.5rem !important;
    }

    /*********************************************/

    /***********/
    /**[ xy  ]**/
    /***********/
    .y_3 {
      width: 3rem !important;
    }

    /***********/
    /**[ bd  ]**/
    /***********/
    .radius_05 {
      border-radius: .5rem !important;
    }

    /***********/
    /**[  f  ]**/
    /***********/
    .fs_075 {
      font-size: .75rem !important;
    }

    .fs_05 {
      font-size: .5rem !important;
    }

    .fs_03 {
      font-size: .3rem !important;
    }

    .fc_red {
      color: red;
    }

    .ff_mplus {
      font-family: 'mplus-1p-light', 'sans-serif';
    }

    /***********/
    /**[ cur ]**/
    /***********/
    .cur_poi {
      cursor: pointer !important;
    }

    /***********/
    /**[  m  ]**/
    /***********/
    .m_02 {
      margin: .2rem !important;
    }

    .m_02_04 {
      margin: .2rem .4rem !important;
    }

    .mx_02 {
      margin-top: .2rem !important;
      margin-bottom: .2rem !important;
    }

    .mr_02 {
      margin-right: .2rem !important;
    }

    /***********/
    /**[  m  ]**/
    /***********/
    .p_02 {
      padding: .2rem !important;
    }
  </style>
</head>
<!--*********************************************************************************************-->

<body class=" dark:bg-slate-800 dark:text-slate-100">
  <!--*********************************************************************************************-->
  <div id="app" class="ff_mplus">
    <div class="columns is-mobile is-centered">
      <!--*********************************************************************************************-->
      <div class="column is-2">
        <article class="panel is-link fs_075">
          <p class="panel-heading is-small">
            Hot Dog <i class="fa-solid fa-dog"></i> <i class="fa-solid fa-hotdog"></i>
          </p>
          <p class="panel-tabs is-small">
            <a v-for="(panel, panel_ind) in ls_pp.panel_list" @click="ls_md.set_panel(panel_ind)" :class="ls_pp.active_panel.board[1] === panel.board[1] ? 'is-active' : ''">
              (% panel.board[0] %)
            </a>
          </p>
          <a v-for="(sub, sub_ind) in ls_pp.active_panel.sub" @click="ls_md.set_panel_sub(sub_ind)" :class="sub[1] === ls_pp.active_panel_sub ? 'panel-block is-active' : 'panel-block'">
            <span class="panel-icon">
              <i :class="sub[2]" aria-hidden="true"></i>
            </span>
            (% sub[0] %)
          </a>
        </article>
      </div>
      <!--*********************************************************************************************-->
      <div v-if="ls_pp.active_panel.board[1] === 'tool_board'" class="column is-10">
        <div v-if="ls_pp.active_panel_sub === 'auto_convert_board'">
          <div v-for="(detail, detail_ind) in ls_pp.product_details" class="columns is-mobile is-centered is-gapless is-multiline box radius_05 fs_075">
            <!--*********************************************************************************************-->
            <div class="column is-5">
              <div class="">
                <!--*********************************************************************************************-->
                <div class="field">
                  <label class="label">自動生成</label>
                  <hr>
                  <!--*********************************************************************************************-->
                  <div class="columns is-centered">
                    <div class="column is-8 p_02">
                      <!--*********************************************************************************************-->
                      <table>
                        <tr>
                          <td><label class="label fs_075">管理番号</label></td>
                          <td>
                            <span @click="ls_md.select_copy($event, 'inner')" class="tag cur_poi tippy_copied m_02">
                              (% detail.pr_code %)
                            </span>
                          </td>
                        </tr>
                        <tr>
                          <td><label class="label fs_075">自社コード</label></td>
                          <td>
                            <span @click="ls_md.select_copy($event, 'inner')" class="tag cur_poi tippy_copied m_02">
                              (% ls_md.get_detail_shop(detail_ind).code %)(% detail.pr_code %)
                            </span>
                          </td>
                        </tr>
                      </table>
                      <!--*********************************************************************************************-->
                    </div>
                    <!--*********************************************************************************************-->
                    <div class="column is-4 p_02">

                    </div>
                    <!--*********************************************************************************************-->
                  </div>
                  <!--*********************************************************************************************-->
                  <hr>
                  <!--*********************************************************************************************-->
                  <div class="columns is-centered">
                    <!--*********************************************************************************************-->
                    <div class="column is-6 p_02">
                      <!--*********************************************************************************************-->
                      <div class="control">
                        <label class="label">JAN</label>
                        <div class="control">
                          <div v-for="(jan, ind) in detail.jans">
                            <span v-if="jan !== ''" @click="ls_md.select_copy($event, 'inner')" class="tag cur_poi tippy_copied">
                              (% jan %)
                            </span>
                          </div>
                        </div>
                      </div>
                      <!--*********************************************************************************************-->
                      <div class="control">
                        <label class="label">品番</label>
                        <div class="control">
                          <div v-for="(jan, ind) in detail.jans">
                            <span v-if="jan !== ''" @click="ls_md.select_copy($event, 'inner')" class="tag cur_poi tippy_copied">
                              (% ls_md.get_detail_maker(detail_ind).code %)-(% ls_md.get_endfive(jan) %)
                            </span>
                          </div>
                        </div>
                      </div>
                      <!--*********************************************************************************************-->
                    </div>
                    <!--*********************************************************************************************-->
                    <div class="column is-6 p_02">
                      <!--*********************************************************************************************-->
                      <div class="control">
                        <label class="label">JAN末尾5桁ー品番</label>
                        <div class="control">
                          <div v-for="(jan, ind) in detail.jans">
                            <span v-if="jan !== ''" @click="ls_md.select_copy($event, 'inner')" class="tag cur_poi tippy_copied">
                              (% ls_md.get_endfive(jan) %)
                              </sp>
                          </div>
                        </div>
                      </div>
                      <!--*********************************************************************************************-->
                    </div>
                    <!--*********************************************************************************************-->
                  </div>
                </div>
                <!--*********************************************************************************************-->
              </div>
            </div>
            <!--*********************************************************************************************-->
            <div class="column is-1">|</div>
            <!--*********************************************************************************************-->
            <div class="column is-6">
              <div class="">
                <!--*********************************************************************************************-->
                <div class="field is-horizontal">
                  <div class="field-label is-normal">
                    <label class="label">SHOP</label>
                  </div>
                  <div class="field-body">
                    <div class="field is-narrow">
                      <div class="control">
                        <div class="select is-fullwidth is-small">
                          <select @change="ls_md.set_freetext_shop(detail_ind)" v-model="detail.shop_ind">
                            <option v-for="(shop, ind) in ls_pp.shop_list" :value="ind">(% shop.text %)</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!--*********************************************************************************************-->
                <div class="field is-horizontal">
                  <div class="field-label is-normal">
                    <label class="label">メーカー</label>
                  </div>
                  <div class="field-body">
                    <div class="field is-narrow">
                      <div class="control">
                        <div class="select is-fullwidth is-small">
                          <select @change="ls_md.set_freetext_maker(detail_ind)" v-model="detail.maker_ind">
                            <option v-for="(maker, ind) in ls_pp.maker_list" :value="ind">(% maker.text %)</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!--*********************************************************************************************-->
                <!--
                <div class="field">
                  <button @click="ls_md.set_input_type(detail_ind, 'text')" :class="[detail.input_type === 'text' ? 'button is-small is-link' : 'button is-small is-link is-outlined']">自由入力形式</button>
                  <button @click="ls_md.set_input_type(detail_ind, 'form')" :class="[detail.input_type === 'form' ? 'button is-small is-link' : 'button is-small is-link is-outlined']">フォーム形式</button>
                </div>
                -->
                <!--*********************************************************************************************-->
                <div v-if="detail.input_type === 'text'" class="field">
                  <label class="label fs_075">自由入力形式</label>
                  <span>※＝＞項目名＋改行＋内容、の形式で記入すると自動判定します！</span>
                  <div class="control">
                    <textarea @input="ls_md.set_detail_freetext(detail_ind)" v-model="detail.free_text" class="textarea is-small" :placeholder="ls_pp.freetext_placeholder" rows="10"></textarea>
                  </div>
                </div>
                <!--*********************************************************************************************-->
                <div class="field is-horizontal">
                  <div class="field-label is-normal">
                    <label class="label">自社ｺｰﾄﾞ</label>
                  </div>
                  <div class="field-body">
                    <div class="field">
                      <div>
                        <div class="control has-icons-right">
                          <input @input="ls_md.set_freetext_pr_code(detail_ind)" v-model="detail.pr_code" :class="[detail.pr_code.length < 8 ? 'input is-small is-danger' : 'input is-small']" placeholder="8桁" type="text">
                          <span class="icon is-right m_02 y_3">
                            <i :class="[detail.pr_code.length < 8 ? 'fc_red' : '']">(% detail.pr_code.length %)<span class="fs_03">ケタ</span></i>
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!--*********************************************************************************************-->
                <hr>
                <!--*********************************************************************************************-->
                <div class="field is-horizontal mx_02">
                  <div class="field-label is-normal">
                    <label class="label">JAN</label>
                  </div>
                  <div class="field-body">
                    <div class="field">
                      <table>
                        (% detail.jans %)
                        <tr v-for="(jan, ind) in detail.jans">
                          <td>
                            <span @click="" class="tag cur_poi m_02">
                              <i class="fa-solid fa-bars"></i>
                            </span>
                          </td>
                          <td class="control has-icons-left has-icons-right">
                            <input @input="ls_md.set_freetext_jans(detail_ind)" v-model="detail.jans[ind]" type="text" :class="[jan.length < 8 ? 'input is-small is-danger' : 'input is-small']" maxlength="15" placeholder="JANを入力">
                            <span class="icon is-left m_02">
                              <i class="fas fa-solid fa-barcode"></i>
                            </span>
                            <span class="icon is-right m_02 y_3">
                              <i :class="[jan.length < 8 ? 'm_02_04 fc_red' : 'm_02_04']">(% jan.length %)<span class="fs_03">ケタ</span></i>
                            </span>
                          </td>
                          <td>
                            <span @click="" class="tag cur_poi m_02">
                              <i class="fa-solid fa-trash mr_02"></i>削除
                            </span>
                          </td>
                        </tr>
                      </table>
                      <button @click="ls_md.add_jan(detail_ind)" class="button is-link is-outlined is-small">Add+</button>
                    </div>
                  </div>
                </div>
                <!--*********************************************************************************************-->
                <div v-if="detail.input_type === 'form'" class="field is-horizontal mx_02">
                  <div class="field-label">
                    <label class="label">品番は？</label>
                  </div>
                  <div class="field-body">
                    <div class="field is-narrow">
                      <div class="control">
                        <label class="radio">
                          <input type="radio" name="member">
                          ある！
                        </label>
                        <label class="radio">
                          <input type="radio" name="member">
                          ない！ので新しく作る
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
                <!--*********************************************************************************************-->
              </div>
            </div>
            <!--*********************************************************************************************-->
          </div>
          <div class="">
            <button @click="ls_md.add_shop_detail()" class="button is-link is-outlined is-small">Add+</button>
          </div>
        </div>
        <div v-if="ls_pp.active_panel_sub === 'other_tool_board'" class="columns is-mobile is-centered is-gapless is-multiline box radius_05 fs_075">
          その他
        </div>
      </div>
      <!--*********************************************************************************************-->


      <!--*********************************************************************************************-->
      <div v-if="ls_pp.active_panel.board[1] === 'setting_board'" class="column is-10">
        <div class="columns is-mobile is-centered is-gapless is-multiline box radius_05 fs_075">
          <!--*********************************************************************************************-->
          <div v-if="ls_pp.active_panel_sub === 'shop_set_panel'" class="column is-12">
            <div>
              SHOPリスト
              <table class="">
                <thead>
                  <tr>
                    <td><i class="fa-solid fa-paw"></i></td>
                    <td>SHOP名</td>
                    <td>コード</td>
                    <td>説明</td>
                    <td></td>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="(shop, shop_ind) in ls_pp.shop_list">
                    <td>
                      <span @click="" class="tag cur_poi m_02">
                        <i class="fa-solid fa-bars"></i>
                      </span>
                    </td>
                    <td><input v-model="shop.text" class="input is-small" type="input"></td>
                    <td><input v-model="shop.code" class="input is-small" type="input"></td>
                    <td><input v-model="shop.descliption" class="input is-small" type="input"></td>
                    <td>
                      <span @click="ls_md.move_shop_list_hidden(shop_ind)" class="tag cur_poi m_02">
                        <i class="fa-solid fa-circle-minus mr_02"></i>
                        非表示にする
                      </span>
                    </td>
                  </tr>
                </tbody>
              </table>
              <button @click="ls_md.add_shop_list()" class="button is-link is-outlined is-small">追加+</button>
              <hr>
              非表示リスト
              <table class="">
                <thead>
                  <tr>
                    <td><i class="fa-solid fa-paw"></i></td>
                    <td>SHOP名</td>
                    <td>コード</td>
                    <td>説明</td>
                    <td></td>
                    <td></td>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="(shop, shop_ind) in ls_pp.shop_list_hidden">
                    <td>
                      <span @click="" class="tag cur_poi m_02">
                        <i class="fa-solid fa-bars"></i>
                      </span>
                    </td>
                    <td><input v-model="shop.text" class="input is-small" type="input"></td>
                    <td><input v-model="shop.code" class="input is-small" type="input"></td>
                    <td><input v-model="shop.descliption" class="input is-small" type="input"></td>
                    <td>
                      <span @click="ls_md.remove_shop_list_hidden(shop_ind)" class="tag cur_poi m_02">
                        <i class="fa-solid fa-trash has-text-dark mr_02"></i>
                        削除
                      </span>
                    </td>
                    <td>
                      <span @click="ls_md.move_shop_list_show(shop_ind)" class="tag cur_poi m_02">
                        <i class="fa-solid fa-arrow-up mr_02"></i>
                        表示する
                      </span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <!--*********************************************************************************************-->
          <div v-if="ls_pp.active_panel_sub === 'maker_set_panel'" class="column is-12">
            <div>
              メーカーリスト
              <table class="">
                <thead>
                  <tr>
                    <td><i class="fa-solid fa-paw"></i></td>
                    <td>メーカー名</td>
                    <td>コード</td>
                    <td>説明</td>
                    <td></td>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="(maker, maker_ind) in ls_pp.maker_list">
                    <td>
                      <span @click="" class="tag cur_poi m_02">
                        <i class="fa-solid fa-bars"></i>
                      </span>
                    </td>
                    <td><input v-model="maker.text" class="input is-small" type="input"></td>
                    <td><input v-model="maker.code" class="input is-small" type="input"></td>
                    <td><input v-model="maker.descliption" class="input is-small" type="input"></td>
                    <td>
                      <span @click="ls_md.move_maker_list_hidden(maker_ind)" class="tag cur_poi m_02">
                        <i class="fa-solid fa-circle-minus mr_02"></i>
                        非表示にする
                      </span>
                    </td>
                  </tr>
                </tbody>
              </table>
              <button @click="ls_md.add_maker_list()" class="button is-link is-outlined is-small">追加+</button>
              <!--*********************************************************************************************-->
              <hr>
              <!--*********************************************************************************************-->
              非表示リスト
              <table class="">
                <thead>
                  <tr>
                    <td><i class="fa-solid fa-paw"></i></td>
                    <td>メーカー名</td>
                    <td>コード</td>
                    <td>説明</td>
                    <td></td>
                    <td></td>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="(maker, maker_ind) in ls_pp.maker_list_hidden">
                    <td>
                      <span @click="" class="tag cur_poi m_02">
                        <i class="fa-solid fa-bars"></i>
                      </span>
                    </td>
                    <td><input v-model="maker.text" class="input is-small" type="input"></td>
                    <td><input v-model="maker.code" class="input is-small" type="input"></td>
                    <td><input v-model="maker.descliption" class="input is-small" type="input"></td>
                    <td>
                      <span @click="ls_md.remove_maker_list_hidden(maker_ind)" class="tag cur_poi m_02">
                        <i class="fa-solid fa-trash has-text-dark mr_02"></i>
                        削除
                      </span>
                    </td>
                    <td>
                      <span @click="ls_md.move_maker_list_show(maker_ind)" class="tag cur_poi m_02">
                        <i class="fa-solid fa-arrow-up mr_02"></i>
                        表示する
                      </span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <!--*********************************************************************************************-->
          <div v-if="ls_pp.active_panel_sub === 'arr_set_panel'" class="column is-12">
            <div>
              配列データ
              <textarea class="textarea is-small">(% ls_pp %)</textarea>
              <button @click="ls_md.delete_local_storage()" class="button is-link is-outlined is-small">データを削除する</button>
            </div>
          </div>
          <!--*********************************************************************************************-->
        </div>
      </div>

      <!--*********************************************************************************************-->

    </div>







    <!--*********************************************************************************************-->
  </div>
  <!--*********************************************************************************************-->
</body>
<script>
  tippy(".endfives", {
    content: "test"
  })
</script>
<script type="module">
  import {
    createApp,
    ref,
    nextTick,
    onBeforeMount,
    onMounted,
    onBeforeUpdate,
    onUpdated,
    onBeforeUnmount,
    onUnmounted
  } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js'


  createApp({
    setup() {
      //
      // ====================================================================================================
      // ==[ LS_PP プロパティクラス ]=============================================================================
      // ====================================================================================================
      //
      const ls_pp = ref({
        active_panel_sub: "auto_convert_board",
        active_panel: {
          board: ["ツール", "tool_board"],
          sub: [
            ["コード変換・自動入力", "auto_convert_board", "fa-solid fa-paw"],
            ["その他", "other_tool_board", "fa-solid fa-paw"]
          ]
        },
        panel_list: [{
            board: ["ツール", "tool_board"],
            sub: [
              ["コード変換・自動入力", "auto_convert_board", "fa-solid fa-paw"],
              ["その他", "other_tool_board", "fa-solid fa-paw"]
            ]
          },
          {
            board: ["各種設定", "setting_board"],
            sub: [
              ["SHOPリスト", "shop_set_panel", "fa-solid fa-gear"],
              ["メーカーリスト", "maker_set_panel", "fa-solid fa-gear"],
              ["データ閲覧削除", "arr_set_panel", "fa-solid fa-gear"]
            ]
          },
        ],
        active_tool: 0,
        freetext_placeholder: `※※入力例※※

自社コード
12345678

品番なし

JAN
1234567890123
1234567890123
1234567890123
`,
        shop_list: [{
            text: "パサージュメンズ",
            code: "Z",
            descliption: "loremipsum loremipsum test text."
          },
          {
            text: "テスト",
            code: "T",
            descliption: "loremipsum loremipsum test text."
          }
        ],
        shop_list_hidden: [],
        maker_list: [{
            text: "testtext",
            code: "TEXT",
            descliption: "loremipsum loremipsum test text."
          },
          {
            text: "example text maker",
            code: "EXAM",
            descliption: "loremipsum loremipsum test text."
          }
        ],
        maker_list_hidden: [],
        product_details: [{
          input_type: "form",
          outuput_type: "form",
          free_text: `＝＞-----
＝＞SHOP

＝＞メーカー

＝＞自社コード


＝＞品番


＝＞JAN

-----＜＝`,
          pr_code: "12345678",
          shop_ind: 0,
          maker_ind: 0,
          jans: ["1234567890123"],
        }]
      })
      //
      // ====================================================================================================
      // ==[ LS_MD メソッドクラス ]=============================================================================
      // ====================================================================================================
      //
      const ls_md = class {
        //
        // 
        // ==[ SET DETAIL ]==============================================================
        //
        // 
        static set_panel = (board_ind) => {
          ls_pp.value.active_panel = ls_pp.value.panel_list[board_ind]
          ls_pp.value.active_panel_sub = ls_pp.value.active_panel.sub[0][1]
        }
        static set_panel_sub = (sub_ind) => {
          ls_pp.value.active_panel_sub = ls_pp.value.active_panel.sub[sub_ind][1]
        }
        //
        // 
        // ==[ GET DETAIL ]==============================================================
        //
        // 
        static get_detail = (detail_ind) => {
          return ls_pp.value.product_details[detail_ind]
        }
        static get_detail_shop = (detail_ind) => {
          return this.get_shop(this.get_detail(detail_ind).shop_ind)
        }
        static get_detail_maker = (detail_ind) => {
          return this.get_maker(this.get_detail(detail_ind).maker_ind)
        }
        static get_detail_pr_code = (detail_ind) => {
          return this.get_detail(detail_ind).pr_code
        }
        static get_detail_jans = (detail_ind) => {
          return this.get_detail(detail_ind).jans
        }
        //
        // 
        // ==[ GET SHOP MAKER ]==============================================================
        //
        // 
        static get_shop = (ind_num) => {
          return ls_pp.value.shop_list[ind_num]
        }
        static get_maker = (ind_num) => {
          return ls_pp.value.maker_list[ind_num]
        }
        //
        // 
        // ==[ GET OTHER ]==============================================================
        //
        // 
        //
        // 後ろから５ケタを返す
        //
        static get_endfive = (str) => {
          return str.substr(-5, 5)
        }
        // 
        //
        static get_pr_code_maker = (detail, jan) => {
          return this.get_shop(detail.shop_ind).code + detail.pr_code + "-" + this.get_maker(detail.maker_ind).code + "-" + this.get_endfive(jan)
        }
        //
        // 
        // ==[ ADD ]==============================================================
        //
        // 
        // detailを追加する
        // 
        static add_shop_detail = () => {
          ls_pp.value.product_details.push({
            input_type: "form",
            outuput_type: "form",
            free_text: `＝＞-----
＝＞SHOP

＝＞メーカー

＝＞自社コード


＝＞品番


＝＞JAN

-----＜＝`,
            pr_code: "",
            shop_ind: 0,
            maker_ind: 0,
            jans: [""]
          })
          nextTick(() => {
            this.init_tippy()
          })
        }
        //
        // JAN の追加
        //
        static add_jan = (detail_ind) => {
          ls_pp.value.product_details[detail_ind].jans.push("")
          nextTick(() => {
            this.init_tippy()
          })
        }
        //
        //
        // ==[ CLIP BOARD COPY ]==============================================================
        //
        //
        //
        // クリップボードにコピー
        //
        static select_copy(e, elem_type) {
          e.target.focus();
          //e.target.select();
          if (elem_type === "inner") {
            navigator.clipboard.writeText(e.target.innerText).then(e => {});
          }
        }
        //
        //
        // ==[ VIEW ]==============================================================
        //
        //
        // 入力画面表示用の分岐用 input_type の制御
        //
        static set_input_type = (detail_ind, input_type) => {
          this.get_detail(detail_ind).input_type = input_type
        }
        //
        // jans の要素に空白があればその要素を削除する
        // 
        static remove_blank_jan = () => {
          ls_pp.value.product_details.forEach((val, ind) => {
            console.log(val.jans)
            val.jans = [...val.jans.filter((jan_val, jan_ind) => {
              return jan_val !== undefined
            })]
            console.log(val.jans)
          })
          console.log(ls_pp.value.product_details[0].jans)
        }
        //
        // 
        // ==[ SPLIT JOIN ]==============================================================
        //
        // 
        static split_lines = (target_str) => {
          // 改行コードで分割
          return target_str.split(/\r\n|\n/)
        }
        static join_lines = (target_arr) => {
          // 改行コードを変換しなおして代入
          return target_arr.join('\n').replace(/\\n/g, "\n")
        }
        //
        // 
        // ==[ SET FORM ➤ FREETEXT ]==============================================================
        //
        // 
        // ショップ情報を フォーム➤テキスト へ反映
        // 
        static set_freetext_shop = (detail_ind) => {
          // detail_ind の配列の free_text を取得して改行コードで配列に変換
          let arr = this.split_lines(this.get_detail(detail_ind).free_text)
          // ターゲットインデックスがない場合はアンカーがないので終了
          const target_ind = arr.indexOf("＝＞SHOP")
          if (target_ind === -1) return
          // ターゲットインデックス＋１の要素が shop 配列に含まれるか検索
          const target_somes = [
            ls_pp.value.shop_list.some(val => {
              return val.text === arr[target_ind + 1]
            }),
            ls_pp.value.shop_list.some(val => {
              return val.code === arr[target_ind + 2]
            }),
          ]
          // ターゲットインデックス＋１の要素が、空白 or shio 配列に含まれる場合上書き、それ以外は splice
          if (arr[target_ind + 1] === "" || target_somes[0]) {
            arr[target_ind + 1] = this.get_detail_shop(detail_ind).text
          } else {
            arr.splice(target_ind + 1, 0, this.get_detail_shop(detail_ind).text)
          }
          if (arr[target_ind + 2] === "" || target_somes[1]) {
            arr[target_ind + 2] = this.get_detail_shop(detail_ind).code
          } else {
            arr.splice(target_ind + 2, 0, this.get_detail_shop(detail_ind).code)
          }
          // 改行コードを変換しなおして代入
          this.get_detail(detail_ind).free_text = this.join_lines(arr)
        }
        // 
        // メーカー情報を フォーム➤テキスト へ反映
        // 
        static set_freetext_maker = (detail_ind) => {
          // detail_ind の配列の free_text を取得して改行コードで配列に変換
          let arr = this.split_lines(this.get_detail(detail_ind).free_text)
          // ターゲットインデックスがない場合はアンカーがないので終了
          const target_ind = arr.indexOf("＝＞メーカー")
          if (target_ind === -1) return
          // ターゲットインデックス＋１の要素が shop 配列に含まれるか検索
          const target_somes = [
            ls_pp.value.maker_list.some(val => {
              return val.text === arr[target_ind + 1]
            }),
            ls_pp.value.maker_list.some(val => {
              return val.code === arr[target_ind + 2]
            }),
          ]
          // ターゲットインデックス＋１の要素が、空白 or shio 配列に含まれる場合上書き、それ以外は splice
          if (arr[target_ind + 1] === "" || target_somes[0]) {
            arr[target_ind + 1] = this.get_detail_maker(detail_ind).text
          } else {
            arr.splice(target_ind + 1, 0, this.get_detail_maker(detail_ind).text)
          }
          if (arr[target_ind + 2] === "" || target_somes[1]) {
            arr[target_ind + 2] = this.get_detail_maker(detail_ind).code
          } else {
            arr.splice(target_ind + 2, 0, this.get_detail_maker(detail_ind).code)
          }
          // 改行コードを変換しなおして代入
          this.get_detail(detail_ind).free_text = this.join_lines(arr)
        }
        // 
        // 自社コードを フォーム➤テキスト へ反映
        // 
        static set_freetext_pr_code = (detail_ind) => {
          // detail_ind の配列の free_text を取得して改行コードで配列に変換
          let arr = this.split_lines(this.get_detail(detail_ind).free_text)
          // ターゲットインデックスがない場合はアンカーがないので終了
          const target_ind = arr.indexOf("＝＞自社コード")
          if (target_ind === -1) return
          // 数値かどうか
          const target_is_nan = isNaN(arr[target_ind + 1])
          // 空白か数値なら上書き
          if (arr[target_ind + 1] === "" || !target_is_nan) {
            arr[target_ind + 1] = this.get_detail_pr_code(detail_ind)
          } else {
            arr.splice(target_ind + 1, 0, this.get_detail_pr_code(detail_ind))
          }
          // 改行コードを変換しなおして代入
          this.get_detail(detail_ind).free_text = this.join_lines(arr)
        }
        // 
        // JANコードを フォーム➤テキスト へ反映
        // 
        static set_freetext_jans = (detail_ind) => {
          // detail_ind の配列の free_text を取得して改行コードで配列に変換
          let arr = this.split_lines(this.get_detail(detail_ind).free_text)
          // ターゲットインデックスがない場合はアンカーがないので終了
          const target_ind = arr.indexOf("＝＞JAN")
          if (target_ind === -1) return
          // 配列取得
          const jans = this.get_detail_jans(detail_ind)
          // 数値かどうか
          const target_is_nans = []
          for (let i = 0; i < jans.length; i++) {
            target_is_nans.push(isNaN(arr[target_ind + i + 1]))
          }
          jans.forEach((val, ind) => {
            if (arr[target_ind + ind + 1] === "" || !target_is_nans[ind]) {
              arr[target_ind + ind + 1] = val
            } else {
              arr.splice(target_ind + ind + 1, 0, val)
            }
          })
          // 改行コードを変換しなおして代入
          this.get_detail(detail_ind).free_text = this.join_lines(arr)
        }
        //
        // 
        // ==[ SET FREETEXT ➤ FORM ]==============================================================
        //
        // 
        // 
        // JANコードを テキスト➤フォーム へ反映
        // 
        static set_detail_freetext = (detail_ind) => {
          // detail_ind の配列の free_text を取得して改行コードで配列に変換
          let arr = this.split_lines(this.get_detail(detail_ind).free_text)
          // このアンカーインデックスをリスト化
          const inds = {
            begin: arr.indexOf("＝＞-----"),
            shop: arr.indexOf("＝＞SHOP"),
            maker: arr.indexOf("＝＞メーカー"),
            pr_code: arr.indexOf("＝＞自社コード"),
            val_code: arr.indexOf("＝＞品番"),
            jans: arr.indexOf("＝＞JAN"),
            end: arr.indexOf("-----＜＝"),
          }
          // 
          // 自社コード
          ls_pp.value.product_details[detail_ind].pr_code = arr[inds.pr_code + 1]
          // 
          // JAN
          const free_jans = []
          for (let i = inds.jans + 1; i < inds.end; i++) {
            free_jans.push(arr[i])
          }

          const jans = ls_pp.value.product_details[detail_ind].jans

          jans.forEach((val, ind) => {
            if (!free_jans.hasOwnProperty(ind)) {
              ls_pp.value.product_details[detail_ind].jans.splice(ind, 1)
            }
          })

          free_jans.forEach((val, ind) => {
            if (jans.hasOwnProperty(ind)) {
              ls_pp.value.product_details[detail_ind].jans[ind] = val
            } else {
              ls_pp.value.product_details[detail_ind].jans.push(val)
            }
          })

          // 改行コードを変換しなおして代入
          this.get_detail(detail_ind).free_text = this.join_lines(arr)
        }
        //
        // 
        // ==[ Tippy js ]==============================================================
        //
        // 
        // 
        // tippy js のツールチップを展開
        // 
        static init_tippy = () => {
          // 改行コードで分割
          tippy(".tippy_copied", {
            content: '<spna class="fs_075"><i class="fa-solid fa-dog"></i>＜コピーしました！</span>',
            trigger: "click",
            placement: "left",
            arrow: true,
            allowHTML: true,
            offset: [0, 0],
            onShow(instance) {
              setTimeout(() => {
                instance.hide()
              }, 600)
            }
          })
        }
        //
        // 
        // ==[ SETTING ]==============================================================
        //
        // 
        // 追加
        static add_shop_list = () => {
          // 改行コードで分割
          ls_pp.value.shop_list.push({
            text: "🐕",
            code: "🐕",
            descliption: "🐕"
          })
        }
        // 非表示
        static move_shop_list_hidden = (shop_ind) => {
          // hiddenn に追加
          ls_pp.value.shop_list_hidden.push(ls_pp.value.shop_list[shop_ind])
          // 削除
          ls_pp.value.shop_list.splice(shop_ind, 1)
        }
        // 表示
        static move_shop_list_show = (shop_ind) => {
          // hiddenn に追加
          ls_pp.value.shop_list.push(ls_pp.value.shop_list_hidden[shop_ind])
          // 削除
          ls_pp.value.shop_list_hidden.splice(shop_ind, 1)
        }
        // 削除
        static remove_hop_list_hidden = (shop_ind) => {
          // 削除
          ls_pp.value.shop_list_hidden.splice(shop_ind, 1)
        }
        //
        // 
        // 追加
        static add_maker_list = () => {
          // 改行コードで分割
          ls_pp.value.maker_list.push({
            text: "🐕",
            code: "🐕",
            descliption: "🐕"
          })
        }
        // 非表示
        static move_maker_list_hidden = (maker_ind) => {
          // hiddenn に追加
          ls_pp.value.maker_list_hidden.push(ls_pp.value.maker_list[maker_ind])
          // 削除
          ls_pp.value.maker_list.splice(maker_ind, 1)
        }
        // 表示
        static move_maker_list_show = (maker_ind) => {
          // hiddenn に追加
          ls_pp.value.maker_list.push(ls_pp.value.maker_list_hidden[maker_ind])
          // 削除
          ls_pp.value.maker_list_hidden.splice(maker_ind, 1)
        }
        // 削除
        static remove_hop_list_hidden = (maker_ind) => {
          // 削除
          ls_pp.value.maker_list_hidden.splice(maker_ind, 1)
        }
        //
        // 
        // ==[ LOCAL STORAGE 保存、取得、削除処理 ]==============================================================
        //
        // 
        static insert_local_storage = () => {
          // ローカルストレージに保存
          const arr = ls_pp.value
          // 暗号化して保存 
          crypto_md.encrypt_rtn("N7kHTemQ", "e8TpP4k9N7kHTemQbH9rEkFVjD4RMcSzR7pk", arr)
          // メインのjsファイルで以下のコードを記述して、インストールされている拡張機能のリストを取得します
        }
        static select_local_storage = () => {
          // ローカルストレージから取得
          crypto_md.decrypt_rtn("N7kHTemQ", "e8TpP4k9N7kHTemQbH9rEkFVjD4RMcSzR7pk", (arr) => {
            console.log(arr)
            if (arr !== null) {
              ls_pp.value = arr
            }
          })
        }
        static delete_local_storage = () => {
          const result = confirm("本当に削除してよろしいですか？")
          if (result) {
            localStorage.removeItem('N7kHTemQ')
            // reloadメソッドによりページをリロード
            window.location.reload();
          }
        }
      }
      //
      // ====================================================================================================
      // ==[ CRYPTO 暗号化＆LOCAL STORAGE 保存 ]==============================================================
      // ====================================================================================================
      // 
      const crypto_md = class {
        static encrypt = async (key, data) => {
          const iv = crypto.getRandomValues(new Uint8Array(16))
          const result = await crypto.subtle.encrypt({
              name: "AES-CBC",
              iv,
            },
            key,
            data
          )
          return new Uint8Array([...iv, ...new Uint8Array(result)])
        }

        static decrypt = async (key, cipher) => {
          const iv = cipher.slice(0, 16)
          const data = cipher.slice(16)
          const result = await crypto.subtle.decrypt({
              name: "AES-CBC",
              iv,
            },
            key,
            data
          )
          return new Uint8Array(result)
        }

        static encodeText = text => new TextEncoder().encode(text)
        static decodeText = text => new TextDecoder().decode(text)

        static passphraseToKey = async passphrase => {
          const pass256 = await crypto.subtle.digest({
              name: "SHA-256"
            },
            this.encodeText(passphrase)
          )
          const key = await crypto.subtle.importKey(
            "raw",
            pass256, {
              name: "AES-CBC",
              length: 256,
            },
            false,
            ["encrypt", "decrypt"]
          )
          return key
        }

        static encrypt_rtn = async (local_key, pass, arr) => {
          const key = await this.passphraseToKey(pass)
          const text = JSON.stringify(arr)
          const bin = this.encodeText(text)
          const encrypted = await this.encrypt(key, bin)
          // 保存
          localStorage.setItem(local_key, encrypted)
        }

        static decrypt_rtn = async (local_key, pass, func) => {
          const key = await this.passphraseToKey(pass)
          // 取得 空ならnullで実行してリターン
          if (!localStorage.getItem(local_key)) {
            func(null)
            return;
          }
          const encrypted = Uint8Array.from(localStorage.getItem(local_key).split(","))
          const decrypted = await this.decrypt(key, encrypted)
          func(JSON.parse(this.decodeText(decrypted)))
        }
      }
      //
      // ====================================================================================================
      // ==[ onMounted ]==============================================================
      // ====================================================================================================
      // 
      onMounted(() => {
        window.onload = () => {
          ls_md.init_tippy()
          ls_md.select_local_storage()
          ls_md.remove_blank_jan()
        }
      })
      //
      // ====================================================================================================
      // ==[ onUpdated ]==============================================================
      // ====================================================================================================
      // 
      onUpdated(() => {
        ls_md.insert_local_storage()

        ls_pp.value.product_details.forEach((val, ind) => {
          ls_md.set_freetext_shop(ind)
          ls_md.set_freetext_maker(ind)
          ls_md.set_freetext_pr_code(ind)
          ls_md.set_freetext_jans(ind)
        })
      })

      return {
        ls_pp,
        ls_md,
        crypto_md
      }
    },
    delimiters: ['(%', '%)']
  }).mount('#app')
</script>
